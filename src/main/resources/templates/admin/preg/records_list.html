<!doctype html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/layout :: head(~{::extraHead})}">
<th:block th:fragment="extraHead">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.bootstrap5.min.css">
  <style>
    .badge-week{font-weight:600}
    .table-responsive{overflow-x:auto}
  </style>
</th:block>

</head>
<body th:replace="~{admin/layout :: layout(~{::content}, ~{::extraJs})}">
	<section th:fragment="content">
		<div class="card">
			<div
				class="card-header d-flex justify-content-between align-items-center">
				<h3 class="card-title mb-0">
					懷孕紀錄 — <span th:text="${mhb.motherName}">媽媽姓名</span> <small
						class="text-muted">（手冊 #<span
						th:text="${mhb.motherHandbookId}">ID</span>）
					</small>
				</h3>
				<a class="btn btn-sm btn-outline-secondary"
					th:href="@{/admin/mhb/list}"> <i class="bi bi-arrow-left"></i>
					返回列表
				</a>
			</div>

			<div class="card-body">
				<div th:if="${#lists.isEmpty(records)}"
					class="alert alert-info mb-0">尚無紀錄</div>

				<div th:unless="${#lists.isEmpty(records)}" class="table-responsive">
					<table id="pregTable"
						class="table table-striped table-bordered align-middle"
						style="width: 100%">
						<thead>
							<tr>
								<th>週數</th>
								<th>就診日</th>
								<th>院所</th>
								<th>診所</th>
								<th>備註</th>
								<th>下次產檢</th>
								<th>體重(kg)</th>
								<th>SP/DP</th>
								<th>胎心音</th>
								<th>更新時間</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="r : ${records}">
								<td><span class="badge text-bg-info badge-week">第<span
										th:text="${r.pregnancyWeek}">0</span>週
								</span></td>
								<td th:text="${r.visitDate}">2025-01-01</td>
								<!-- 目前僅顯示 clinicId；若日後要顯示院所名稱，可改成 Service 組裝或 JOIN -->
								<td th:text="${r.clinicId}">—</td>
								<td th:text="${r.clinic != null ? r.clinic.clinicName : '—'}">—</td>
								<td th:text="${r.bodyCondition}">—</td>
								<td><span th:text="${r.nextCheckDate}">—</span> <small
									class="ms-1 text-danger"
									th:if="${r.nextCheckDate != null and !r.nextCheckDate.isBefore(T(java.time.LocalDate).now()) and r.nextCheckDate.isBefore(T(java.time.LocalDate).now().plusDays(7))}">近7天</small>
								</td>
								<td th:text="${r.weight}">—</td>
								<td><span th:text="${r.sp}">—</span>/<span
									th:text="${r.dp}">—</span></td>
								<td th:text="${r.fhs}">—</td>
								<td th:text="${r.updateTime}">—</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</section>
	<th:block th:fragment="extraJs"><script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js" defer></script>
  <script src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.min.js" defer></script>

  <script defer>
    document.addEventListener('DOMContentLoaded', function () {
      if (!window.jQuery || !$.fn || !$.fn.dataTable) {
        console.error('DataTables 或 jQuery 未正確載入'); return;
      }
      $('#pregTable').DataTable({
        order: [[1, 'desc']],             // 依就診日由新到舊
        pageLength: 10,
        lengthMenu: [5,10,20,50,100],
        language: {
          processing:"處理中...", loadingRecords:"載入中...", lengthMenu:"顯示 _MENU_ 筆結果",
          zeroRecords:"沒有符合的結果", info:"顯示第 _START_ 至 _END_ 筆結果，共 <span class='text-danger'>_TOTAL_</span> 筆",
          infoEmpty:"顯示第 0 至 0 筆結果，共 0 筆", infoFiltered:"(從 _MAX_ 筆結果中過濾)",
          search:"搜尋：", paginate:{first:"第一頁", previous:"上一頁", next:"下一頁", last:"最後一頁"},
          aria:{sortAscending:": 升冪排列", sortDescending:": 降冪排列"}
        },
        columnDefs: [{ targets:[3], orderable:false }] // 備註欄不排序（可調）
      });
    });
  </script>
</th:block>
</body>
</html>
