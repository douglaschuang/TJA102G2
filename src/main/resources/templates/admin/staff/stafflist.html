<!doctype html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/layout :: head(~{::extraHead})}"></head>

<body class="sidebar-expand-lg sidebar-open bg-body-tertiary">
	<!-- 子頁額外樣式：只放 DataTables 的 Bootstrap5 佈景（放在 body 裡，讓 head 的片段替換更穩定） -->
	<th:block th:fragment="extraHead">
		<link rel="stylesheet"
			href="https://cdn.datatables.net/2.0.7/css/dataTables.bootstrap5.min.css">
	</th:block>

	<!-- 用版型把下面兩個片段插入（容器會被整個替換，不會重複渲染） -->
	<div th:replace="~{admin/layout :: layout(~{::content}, ~{::extraJs})}">
		<!-- 內容區（fragment） -->
		<section th:fragment="content">
			<div class="card">
			        <div class="card-header d-flex justify-content-between align-items-center">
          <h3 class="card-title mb-0">員工管理</h3>
          <div class="ms-auto">
            <a class="btn btn-sm btn-primary" th:href="@{/staff/staffadd}">
              <i class="bi bi-plus-circle"></i> 新增
            </a>
          </div>
        </div>
			
<!-- 				<div class="card-header"> -->
<!-- 					<h3>使用者列表</h3> -->

<!-- 					錯誤表列 -->
<!-- 					<div class="errorblock" th:utext="${errorMessage}">${errorMessage}</div> -->
<!-- 					<br> <a href="/staff/staffadd" class="btn btn-success mb-3"> -->
<!-- 						<i class="fas fa-plus"></i> 新增 -->
<!-- 					</a> -->
<!-- 				</div> -->

				<div class="card-body">
					<!--         <table id="example1" class="table table-bordered table-hover"> -->
					<table id="example1"
						class="table table-striped table-bordered align-middle w-100">
						<!--           <thead class="thead-dark"> -->
						<thead class="thead-light">
							<tr>
								<th>員工ID</th>
								<th>帳號</th>
								<th>暱稱</th>
								<th>角色</th>
								<th>狀態</th>
								<th>更新時間</th>
								<th>頭像</th>
								<th>修改</th>
								<th>刪除</th>
								<th>密碼變更</th>
							</tr>
						</thead>
						<tbody>
							<th:block th:each="staffVO : ${staffListData}">
								<tr>
									<td th:text="${staffVO.staffId}"></td>
									<td th:text="${staffVO.account}"></td>
									<td th:text="${staffVO.nickname}"></td>
									<!-- 				<td th:text="${staffVO.password}"></td> -->
									<td th:text="${staffVO.role}"></td>
									<!-- 				<td th:text="${staffVO.status}"></td> -->
									<td th:text="${staffVO.status == 1 ? '啟用' : '停用'}"></td>
									<td th:text="${staffVO.getFormattedUpdateDate()}"></td>
									<!-- 				<td th:text="${staffVO.updateDate}"></td> -->
									<td><img
										th:src="@{/util/DBPicReader} + '?staffId=' + ${staffVO.staffId}"
										width="100px"></td>
									<td>
										<form method="post" th:action="@{/staff/staffedit}"
											style="margin-bottom: 0px;">
											<input type="submit" value="修改"> <input type="hidden"
												name="staffId" th:value="${staffVO.staffId}">
										</form>
									</td>

									<td>
										<form method="post" th:action="@{/staff/delete}"
											style="margin-bottom: 0px;"
											onsubmit="return confirm('確定要刪除嗎?')">
											<input type="submit" value="刪除"> <input type="hidden"
												name="staffId" th:value="${staffVO.staffId}">
										</form>
									</td>

									<td>
										<form method="post" th:action="@{/staff/staffchangepwd}"
											style="margin-bottom: 0px;">
											<input type="submit" value="密碼變更"> <input
												type="hidden" name="staffId" th:value="${staffVO.staffId}">
										</form>
									</td>


									<!--                 <td> -->
									<!--                 <a href="/staff/staffedit" class="btn btn-sm btn-primary"> -->
									<!--                   <i class="fas fa-edit"></i> 修改 -->
									<!--                 </a> -->
									<!--                 <button class="btn btn-sm btn-danger" onclick="deleteUser(1)"> -->
									<!--                   <i class="fas fa-trash"></i> 刪除 -->
									<!--                 </button> -->
									<!--                 </td> -->
								</tr>

								<!-- 可依需求新增更多列 -->
							</th:block>
						</tbody>
						<!--           <tfoot class="thead-dark"> -->
						<tfoot class="thead-light">
							<tr>
								<th>員工ID</th>
								<th>帳號</th>
								<th>暱稱</th>
								<th>角色</th>
								<th>狀態</th>
								<th>更新時間</th>
								<th>頭像</th>
								<th>修改</th>
								<th>刪除</th>
								<th>密碼變更</th>
							</tr>
						</tfoot>
					</table>
				</div>
			</div>
		</section>
	</div>

	<!-- 本頁 JS（fragment） -->
	<th:block th:fragment="extraJs">
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>
		<script
			src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.min.js"></script>
		<script>
			document
					.addEventListener(
							'DOMContentLoaded',
							function() {
								const sel = '#example1';
								if ($.fn.DataTable.isDataTable(sel))
									return; // 防止重複初始化
								$(sel)
										.DataTable(
												{
													retrieve : true,
													lengthMenu : [ 3, 5, 10,
															20, 50, 100 ],
													language : {
														processing : "處理中...",
														loadingRecords : "載入中...",
														lengthMenu : "顯示 _MENU_ 筆結果",
														zeroRecords : "沒有符合的結果",
														info : "顯示第 _START_ 至 _END_ 筆結果，共 <span class='text-danger'>_TOTAL_</span> 筆",
														infoEmpty : "顯示第 0 至 0 筆結果，共 0 筆",
														infoFiltered : "(從 _MAX_ 筆結果中過濾)",
														search : "搜尋：",
														paginate : {
															first : "第一頁",
															previous : "上一頁",
															next : "下一頁",
															last : "最後一頁"
														},
														aria : {
															sortAscending : ": 升冪排列",
															sortDescending : ": 降冪排列"
														}
													}
												});
							});
		</script>
	</th:block>
	</div>
</body>
</html>
