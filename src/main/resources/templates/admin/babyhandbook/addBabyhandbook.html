<!doctype html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/layout :: head(~{::extraHead})}"></head>

<body class="sidebar-expand-lg bg-body-tertiary">
	<!-- 本頁額外 CSS -->
	<th:block th:fragment="extraHead">
		<style>
.preview-img {
	max-width: 160px;
	max-height: 120px;
	object-fit: cover;
	border-radius: .25rem;
}
</style>
	</th:block>

	<!-- 用 layout 取代此容器，並把 content / extraJs 傳入 -->
	<div
		th:replace="~{admin/layout :: layout(content=~{::content}, extraJs=~{::extraJs})}">

		<section th:fragment="content">
			<div class="container-fluid">
				<div class="card">
					<div
						class="card-header d-flex justify-content-between align-items-center">
						<h3 class="card-title mb-0">小孩手冊｜新增</h3>
						<div class="ms-auto">
							<a class="btn btn-sm btn-outline-secondary"
								th:href="@{/admin/babyhandbook/list}"> <i
								class="bi bi-arrow-left"></i> 回列表
							</a>
						</div>
					</div>

					<div class="card-body">
						<!-- 一定要 multipart -->
						<form th:action="@{/admin/babyhandbook/insert}" method="post"
							th:object="${babyhandbookVO}" enctype="multipart/form-data"
							class="row g-3">
							<!-- 供 @NotNull 的 memberId 綁定；日後可改成登入者 id -->
							<input type="hidden" th:field="*{member.memberId}" /> <input
								th:if="${_csrf != null}" type="hidden"
								th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

							<div class="col-md-6">
								<label class="form-label">小孩姓名:</label> <input type="text"
									th:field="*{babyname}" class="form-control"
									th:classappend="${#fields.hasErrors('babyname')}? ' is-invalid'" />
								<div class="invalid-feedback"
									th:if="${#fields.hasErrors('babyname')}"
									th:errors="*{babyname}"></div>
							</div>

							<div class="col-md-6">
								<label class="form-label">小孩性別:</label> <select
									class="form-select" th:field="*{babygender}"
									onclick="hideContent('babygender.errors');">
									<option value="">請選擇性別</option>
									<option th:each="entry : ${babyhandbookMap}"
										th:value="${entry.key}" th:text="${entry.value}"></option>
								</select>
								<div class="text-danger small"
									th:if="${#fields.hasErrors('babygender')}"
									th:errors="*{babygender}" id="babygender.errors"></div>
							</div>

							<div class="col-md-6">
								<label class="form-label">小孩生日:</label> <input type="date"
									th:field="*{babybirthday}" class="form-control"
									th:classappend="${#fields.hasErrors('babybirthday')}? ' is-invalid'" />
								<div class="invalid-feedback"
									th:if="${#fields.hasErrors('babybirthday')}"
									th:errors="*{babybirthday}"></div>
							</div>

							<div class="col-md-6">
								<label class="form-label">照片:</label> <input type="file"
									class="form-control" th:field="*{babyhandbookfiles}"
									onchange="previewImage(); hideContent('babyhandbookfiles.errors');"
									accept="image/*" />

								<div class="text-danger small" th:utext="${errorMessage}"
									id="babyhandbookfiles.errors"></div>

								<!-- 預覽區 -->
								<div class="mt-2">
									<img id="preview" class="img-thumbnail preview-img d-none"
										alt="預覽圖">
								</div>

							</div>

							<div class="col-12 d-flex gap-2">
								<button type="submit" class="btn btn-primary">
									<i class="bi bi-check2-circle"></i> 送出新增
								</button>
								<a class="btn btn-outline-secondary"
									th:href="@{/admin/babyhandbook/list}">取消</a>
							</div>
						</form>
					</div>
				</div>
			</div>
		</section>

		<!-- 本頁不需額外 JS -->
		<th:block th:fragment="extraJs">
			<script>
				function previewImage() {
					const input = document.querySelector('input[type="file"]');
					const preview = document.getElementById('preview');
					const file = input.files[0];

					if (file) {
						const reader = new FileReader();
						reader.onload = function(e) {
							preview.src = e.target.result;
							preview.classList.remove('d-none');
						};
						reader.readAsDataURL(file);
					}
				}
			</script>
		</th:block>
	</div>
</body>
</html>
