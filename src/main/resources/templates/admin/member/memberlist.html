<!doctype html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/layout :: head(~{::extraHead})}"></head>

<body class="sidebar-expand-lg sidebar-open bg-body-tertiary">
  <!-- 子頁額外樣式：只放 DataTables 的 Bootstrap5 佈景（放在 body 裡，讓 head 的片段替換更穩定） -->
  <th:block th:fragment="extraHead">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.bootstrap5.min.css">
  </th:block>

  <!-- 用版型把下面兩個片段插入（容器會被整個替換，不會重複渲染） -->
  <div th:replace="~{admin/layout :: layout(~{::content}, ~{::extraJs})}">
    <!-- 內容區（fragment） -->
    <section th:fragment="content">
      <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3>會員列表</h3>
        <div class="ms-auto">
            <a class="btn btn-sm btn-seccondary" th:href="@{/export/memberExcel}">
              <i class="bi bi-box-arrow-up"></i> 匯出Excel
            </a>
          </div>
        
        <!-- 錯誤表列 -->
<!-- 		<div class="errorblock" th:utext="${errorMessage}">${errorMessage}</div><br> -->
<!-- 		<div class="successblock" th:utext="${successMessage}">${successMessage}</div> -->
					<div class="alert alert-danger d-flex align-items-center mt-4" role="alert" th:if="${errorMessage}">
  						<i class="bi bi-exclamation-triangle-fill me-2" style="font-size: 1.5rem;"></i>
  						<span th:text="${errorMessage}"></span>
					</div>
					<div class="alert alert-success fade-in d-flex align-items-center mt-4" role="alert" th:if="${successMessage}">
  						<i class="bi bi-check-circle-fill me-2" style="font-size: 1.5rem;"></i>
  						<span th:text="${successMessage}"></span>
					</div>
        
      </div>
      <div class="card-body">
        <table id="example1" class="table table-striped table-bordered align-middle w-100">
          <thead class="thead-light">
            <tr>
              <th class="text-center">會員ID</th>
              <th>帳號</th>
              <th>名稱</th>
              <th class="text-center">頭像</th>
              <th class="text-center">狀態</th>
<!--               <th>收件人</th> -->
<!--               <th>電話</th> -->
<!--               <th>地址</th> -->
<!--               <th>性別</th> -->
<!--               <th>生日</th> -->
<!--               <th>信箱驗證</th> -->
              <th class="text-center">註冊日期</th>
              <th class="text-center">最後登入時間</th>
<!--               <th>信箱驗證代碼</th> -->
<!--               <th>密碼驗證代碼</th> -->
<!--               <th>密碼驗證代碼有效期限</th> -->
<!--               <th>資料更新時間</th> -->
              <th class="text-center">修改</th>
			  <th class="text-center">停用</th>
			  <th class="text-center">密碼重設</th>
            </tr>
          </thead>
          <tbody>
          	<th:block th:each="memberVO : ${memberListData}">
            <tr>
                <td class="text-center" th:text="${memberVO.memberId}"></td>
				<td th:text="${memberVO.account}"></td>
				<td th:text="${memberVO.name}"></td>
				<td><img th:src="@{/util/DBPicReader1} + '?memberId=' + ${memberVO.memberId}" width="100px"></td>
<!-- 				<td th:text="${memberVO.password}"></td> -->
<!-- 				<td th:text="${memberVO.accountStatus}"></td> -->
				<td class="text-center" th:switch="${memberVO.accountStatus ?: -1}">
  					<span th:case="0" class="badge bg-secondary">未啟用</span>
  					<span th:case="1" class="badge bg-success">已啟用</span>
  					<span th:case="2" class="badge bg-danger">已停用</span>
  					<span th:case="*" class="badge bg-dark">未知狀態</span>
				</td>
<!-- 				<td th:text="${memberVO.recipientName}"></td> -->
<!-- 				<td th:text="${memberVO.phone}"></td> -->
<!-- 				<td th:text="${memberVO.address}"></td> -->
<!-- 				<td th:text="${memberVO.gender}"></td> -->
<!-- 				<td th:text="${memberVO.getFormattedDate(memberVO.birthday)}"></td> -->
<!-- 				<td th:text="${memberVO.emailVerified}"></td> -->
				<td class="text-center" th:text="${memberVO.getFormattedDate(memberVO.registerDate)}"></td>
				<td class="text-center" th:text="${memberVO.getFormattedDateTime(memberVO.lastLoginTime)}"></td>
<!-- 				<td th:text="${memberVO.emailAuthToken}"></td> -->
<!-- 				<td th:text="${memberVO.pwdResetToken}"></td> -->
<!-- 				<td th:text="${memberVO.pwdResetExpire}"></td> -->
<!-- 				<td th:text="${memberVO.getFormattedDateTime(memberVO.updateDate)}"></td> -->
			<td class="text-center">
			  <form method="post" th:action="@{/member/getOne_For_Display}" style="margin-bottom: 0px;">
			     <input type="submit" class="btn btn btn-outline-dark btn-sm" value="檢視">
			     <input type="hidden" name="memberId" th:value="${memberVO.memberId}"></form>
			</td>
			
			<td class="text-center">
<!-- 			  <form method="get" th:action="@{/member/memberSuspend}+ '?memberId=' + ${memberVO.memberId}" style="margin-bottom: 0px;"> -->
			  <form method="post" th:action="@{/member/memberSuspend}" style="margin-bottom: 0px;">
<!-- 			     <input type="submit" value="停用" th:attr="disabled=${memberVO.accountStatus != 1}"> -->
 				 <input type="submit" th:value="${memberVO.accountStatus == 1} ? '停用' : '啟用'"
      				th:attr="class=${memberVO.accountStatus == 1} ? 'btn btn-danger btn-sm' : 'btn btn-success btn-sm'" />
			     <input type="hidden" name="memberId" th:value="${memberVO.memberId}"></form>
			</td >
			
			<td class="text-center">
			  <form method="post" th:action="@{/member/memberResetPwd}" style="margin-bottom: 0px;">
			     <input type="submit" class="btn btn-warning btn-sm" value="密碼重設">
			     <input type="hidden" name="memberId" th:value="${memberVO.memberId}"></form>
			</td>


<!--                 <td> -->
<!--                 <a href="/staff/staffedit" class="btn btn-sm btn-primary"> -->
<!--                   <i class="fas fa-edit"></i> 修改 -->
<!--                 </a> -->
<!--                 <button class="btn btn-sm btn-danger" onclick="deleteUser(1)"> -->
<!--                   <i class="fas fa-trash"></i> 刪除 -->
<!--                 </button> -->
<!--                 </td> -->
            </tr>

            <!-- 可依需求新增更多列 -->
          </tbody>
          <tfoot class="thead-light">
            <tr>
              <th class="text-center">會員ID</th>
              <th>帳號</th>
              <th>名稱</th>
              <th class="text-center">頭像</th>
              <th class="text-center">狀態</th>
<!--               <th>收件人</th> -->
<!--               <th>電話</th> -->
<!--               <th>地址</th> -->
<!--               <th>性別</th> -->
<!--               <th>生日</th> -->
<!--               <th>信箱驗證</th> -->
              <th class="text-center">註冊日期</th>
              <th class="text-center">最後登入時間</th>
<!--               <th>信箱驗證代碼</th> -->
<!--               <th>密碼驗證代碼</th> -->
<!--               <th>密碼驗證代碼有效期限</th> -->
<!--               <th>資料更新時間</th> -->
              <th class="text-center">修改</th>
			  <th class="text-center">停用</th>
			  <th class="text-center">密碼重設</th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
        </section>
      </div>

    <!-- 本頁 JS（fragment） -->
    <th:block th:fragment="extraJs">
      <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
      <script src="https://cdn.datatables.net/2.0.7/js/dataTables.min.js"></script>
      <script src="https://cdn.datatables.net/2.0.7/js/dataTables.bootstrap5.min.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const sel = '#example1';
          if ($.fn.DataTable.isDataTable(sel)) return; // 防止重複初始化
          $(sel).DataTable({
            retrieve: true,
            lengthMenu: [3, 5, 10, 20, 50, 100],
            language: {
              processing:"處理中...", loadingRecords:"載入中...",
              lengthMenu:"顯示 _MENU_ 筆結果", zeroRecords:"沒有符合的結果",
              info:"顯示第 _START_ 至 _END_ 筆結果，共 <span class='text-danger'>_TOTAL_</span> 筆",
              infoEmpty:"顯示第 0 至 0 筆結果，共 0 筆",
              infoFiltered:"(從 _MAX_ 筆結果中過濾)", search:"搜尋：",
              paginate:{ first:"第一頁", previous:"上一頁", next:"下一頁", last:"最後一頁" },
              aria:{ sortAscending:": 升冪排列", sortDescending:": 降冪排列" }
            }
          });
        });
      </script>
      
        <script>
  document.addEventListener("DOMContentLoaded", function () {
	  const alertBoxes = document.querySelectorAll('.alert');
	  alertBoxes.forEach((alertBox) => {
	    setTimeout(() => {
	      alertBox.style.transition = 'opacity 0.5s ease';
	      alertBox.style.opacity = '0';
	      setTimeout(() => alertBox.remove(), 500);
	    }, 3000); // 3 秒後消失
	  });
	});
</script>

    </th:block>
  </div>
</body>
</html>
