<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{frontend/forum_layout :: forumHead('看板 - ' + ${board.boardName}, null)}"></head>

<body th:replace="~{frontend/forum_layout :: forumLayout(
    pageTitle       = '看板 - ' + ${board.boardName},
    headerType      = 'forum',
    content         = ~{:: pageContent},
    extraJs         = ~{:: pageScripts},
    footerClass     = 'footer-one',
    breadcrumbTitle = ${board.boardName}
)}">

<th:block th:fragment="pageContent">
    <div class="row">
        <div class="col-lg-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <span>
                    <h3 th:text="${board.boardName}" class="mb-0">看板名稱</h3>
                    <p th:text="${board.boardLine}" class="text-muted mb-0">看板介紹</p>
                </span>
                <a th:href="@{/forum/board/{boardId}/post/new(boardId=${board.boardId})}" class="btn btn-primary">發表新文章</a>
            </div>
        </div>
        
        <div class="col-lg-12" th:replace="~{frontend/forum_layout :: postList(${postPage.content}, ${postPage.number + 1}, ${postPage.totalPages})}">
        </div>
    </div>
</th:block>

    <th:block th:fragment="pageScripts">
        <script>
        // 把跟 forum.html 一模一樣的 AJAX 腳本複製過來
        document.addEventListener("DOMContentLoaded", function() {
            const likeButtons = document.querySelectorAll('.like-btn');
            likeButtons.forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault();
                    const postId = this.dataset.postId;
                    fetch(`/api/posts/${postId}/toggle-like`, { method: 'POST' })
                    .then(response => {
                        if (!response.ok) {
                            alert('請先登入才能收藏文章！');
                            throw new Error('Server error');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.liked) {
                            this.innerHTML = '<span>❤️</span>';
                        } else {
                            this.innerHTML = '<span>♡</span>';
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            });
        });
        </script>
    </th:block>

</body>
</html>