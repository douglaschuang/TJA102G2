<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{frontend/forum_layout :: forumHead('發表新文章 - ' + ${board.boardName}, ~{:: pageStyles})}"></head>

<body th:replace="~{frontend/forum_layout :: forumLayout(
    pageTitle       = '發表新文章',
    headerType      = 'forum',
    content         = ~{:: pageContent},
    extraJs         = ~{:: pageScripts}, footerClass     = 'footer-one',
    breadcrumbTitle = '發表新文章'
)}">

    <th:block th:fragment="pageContent">
        <div class="new-post-container card p-4 shadow-sm">
            <h4 class="mb-3">在看板「<span th:text="${board.boardName}"></span>」發表新文章</h4>

            <form th:action="@{/forum/post/create}" th:object="${postVO}" method="post">
                <input type="hidden" name="boardId" th:value="${board.boardId}" />
                <div class="mb-3">
                    <label for="postTitle" class="form-label">文章標題</label>
                    <input type="text" id="postTitle" class="form-control" th:field="*{postTitle}" placeholder="請輸入標題" required />
                </div>
                <div class="mb-3">
                    <label for="postLine" class="form-label">文章內容</label>
<textarea id="postLine" class="form-control" th:field="*{postLine}" rows="10" placeholder="寫下你的內容..."></textarea>
                </div>
                <button type="submit" class="btn btn-success">送出文章</button>
            </form>
        </div>
    </th:block>
	
	    <th:block th:fragment="pageStyles">
        <style>
            .ck-editor__editable_inline {
                min-height: 400px;
            }
        </style>
    </th:block>
	
	
<th:block th:fragment="pageScripts">
    <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // 先宣告一個變數來存放編輯器實體
            let postEditor;

            // 找到 id 為 "postLine" 的 textarea，並把它變成 CKEditor
            ClassicEditor
                .create(document.querySelector('#postLine'))
                .then(editor => {
                    // 把創建好的編輯器存起來
                    postEditor = editor;
                    console.log("CKEditor 初始化完成。");
                })
                .catch(error => {
                    console.error('CKEditor 發生錯誤:', error);
                });

            // 找到汝的表單
            const form = document.querySelector('form');

            // 監聽表單的 "submit" 事件
            form.addEventListener('submit', function(event) {
                if (postEditor) {
                    // 在表單真正送出前，從編輯器取得最新內容
                    const editorData = postEditor.getData();
                    // 將內容更新回原本的 textarea
                    document.querySelector('#postLine').value = editorData;
                }
            });
        });
    </script>
</th:block>

</body>
</html>