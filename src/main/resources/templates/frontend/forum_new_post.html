<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{frontend/forum_layout :: forumHead('發表新文章 - ' + ${board.boardName}, ~{::extraHead})}">
    <th:block th:fragment="extraHead">
        <style>
            .ck-editor__editable {
                min-height: 400px;
            }
        </style>
        <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
    </th:block>
</head>

<body th:replace="~{frontend/forum_layout :: forumLayout(
    pageTitle       = '發表新文章',
    headerType      = 'forum',
    content         = ~{:: pageContent},
    extraJs         = ~{:: pageScripts},  
    footerClass     = 'footer-one',
    breadcrumbTitle = '發表新文章'
)}">

    <th:block th:fragment="pageContent">
        <div class="new-post-container card p-4 shadow-sm">
            <h4 class="mb-3">在看板「<span th:text="${board.boardName}"></span>」發表新文章</h4>

            <form id="newPostForm" th:action="@{/forum/post/create}" th:object="${postVO}" method="post">

                <input type="hidden" name="boardId" th:value="${board.boardId}" />

                <div class="mb-3">
                    <label for="postTitle" class="form-label">文章標題</label>
                    <input type="text" id="postTitle" class="form-control" th:field="*{postTitle}" placeholder="請輸入標題" required />
                </div>

                <div class="mb-3">
                    <label for="postLine" class="form-label">文章內容</label>
                    <textarea id="postLine" class="form-control" th:field="*{postLine}" rows="10" placeholder="寫下你的內容..." ></textarea>
                </div>

                <button type="submit" class="btn btn-success">送出文章</button>
            </form>
        </div>
    </th:block>

    <th:block th:fragment="pageScripts">
        <script>
            // 用一個變數來接住我們建立的編輯器實體
            let editor;

            ClassicEditor
                .create( document.querySelector( '#postLine' ), {
                    language: 'zh'
                } )
                .then( newEditor => {
                    editor = newEditor; // 把建立好的編輯器存起來
                } )
                .catch( error => {
                    console.error( error );
                } );

            // ★★★ 步驟二：監聽表單的提交事件 ★★★
            document.getElementById('newPostForm').addEventListener('submit', function(event) {
                if (editor) {
                    // 在表單提交前，呼叫 updateSourceElement() 方法
                    // 這會把 CKEditor 編輯介面裡的內容，同步回原本的 <textarea>
                    editor.updateSourceElement();
                }
            });
        </script>
    </th:block>

</body>
</html>