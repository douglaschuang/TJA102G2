<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{frontend/forum_layout :: forumHead('我的收藏', null)}"></head>

<body th:replace="~{frontend/forum_layout :: forumLayout(
    pageTitle       = '我的收藏',
    headerType      = 'forum',
    content         = ~{:: pageContent},
    extraJs         = ~{:: pageScripts},
    footerClass     = 'footer-one',
    breadcrumbTitle = '我的收藏'
)}">

<th:block th:fragment="pageContent">
    <div class="row">
        <div class="col-lg-12">
            <div class="mb-4">
                <h3 class="mb-0">我的收藏</h3>
                <p class="text-muted mb-0">這裡會列出所有你收藏過的文章。</p>
            </div>
        </div>
        
        <div class="col-lg-12" th:replace="~{frontend/forum_layout :: postList(${postPage.content}, ${postPage.number + 1}, ${postPage.totalPages})}">
        </div>
    </div>
</th:block>

    <th:block th:fragment="pageScripts">
        <script>
        document.addEventListener("DOMContentLoaded", function() {
            const likeButtons = document.querySelectorAll('.like-btn');
            likeButtons.forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault();
                    const postId = this.dataset.postId;
                    fetch(`/api/posts/${postId}/toggle-like`, { method: 'POST' })
                    .then(response => {
                        if (!response.ok) {
                            alert('請先登入才能收藏文章！');
                            throw new Error('Server error');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.liked) {
                            this.innerHTML = '<span>❤️</span>';
                        } else {
                            this.innerHTML = '<span>♡</span>';
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            });
        });
        </script>
    </th:block>

</body>
</html>