<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{frontend/forum_layout :: forumHead('編輯文章', ~{:: pageStyles})}"></head>

<body th:replace="~{frontend/forum_layout :: forumLayout(
    pageTitle       = '編輯文章',
    headerType      = 'forum',
    content         = ~{:: pageContent},
    extraJs         = ~{:: pageScripts}, 
    footerClass     = 'footer-one',
    breadcrumbTitle = '編輯文章'
)}">

    <th:block th:fragment="pageContent">
        <div class="edit-post-container card p-4 shadow-sm">
            
            <h4 class="mb-3">正在編輯文章：「<span th:text="${postVO.postTitle}"></span>」</h4>

            <form th:action="@{/forum/post/update}" th:object="${postVO}" method="post">

                <input type="hidden" th:field="*{postId}" />

                <div class="mb-3">
                    <label for="postTitle" class="form-label">文章標題</label>
                    <input type="text" id="postTitle" class="form-control" th:field="*{postTitle}" required />
                </div>

                <div class="mb-3">
                    <label for="postLine" class="form-label">文章內容</label>
                    <textarea id="postLine" class="form-control" th:field="*{postLine}" rows="10"></textarea>
                </div>

                <button type="submit" class="btn btn-primary">儲存變更</button>
                <a th:href="@{/forum/board/{boardId}/post/{postId}(boardId=*{boardVO.boardId}, postId=*{postId})}" class="btn btn-secondary">取消</a>
            </form>
        </div>
    </th:block>
	
    <th:block th:fragment="pageStyles">
        <style>
            .ck-editor__editable_inline {
                min-height: 400px;
            }
        </style>
    </th:block>
	
	<th:block th:fragment="pageScripts">
        <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                let postEditor;

                ClassicEditor
                    .create(document.querySelector('#postLine'))
                    .then(editor => {
                        postEditor = editor;
                    })
                    .catch(error => {
                        console.error('CKEditor 初始化發生錯誤:', error);
                    });

                const form = document.querySelector('form');
                form.addEventListener('submit', function(event) {
                    if (postEditor) {
                        const editorData = postEditor.getData();
                        document.querySelector('#postLine').value = editorData;
                    }
                });
            });
        </script>
    </th:block>

</body>
</html>