<!DOCTYPE html>
<html class="no-js" lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{frontend/layout :: head('BabyMate', ~{::extraHead})}">
  <th:block th:fragment="extraHead"></th:block>
</head>

<body th:replace="~{frontend/layout :: layout('about', ~{::content}, ~{::extraJs}, 'footer-one')}">
<section th:fragment="content">
<div th:replace="~{frontend/fragments/breadcrumb :: breadcrumb('æˆ‘çš„æœƒå“¡è³‡æ–™')}"></div>


	<!-- page wrapper -->
	<!-- My account content --> 
	<div class="my-account-area mb-130 mb-md-70 mb-sm-70 mb-xs-70 mb-xxs-70">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="row">
          <!-- å´é‚Šé¸å–® -->
          <div class="col-lg-12 col-md-12">
            <div class="myaccount-tab-menu nav" role="tablist">
<!--               <a href="#dashboad" class="active" data-bs-toggle="tab">Dashboard</a> -->
<!--               <a href="#orders" data-bs-toggle="tab">Orders</a> -->
<!--               <a href="#download" data-bs-toggle="tab">Download</a> -->
<!--               <a href="#payment-method" data-bs-toggle="tab">Payment Method</a> -->
              <a href="#account-info" class="active" data-bs-toggle="tab">åŸºæœ¬è³‡æ–™</a>
              <a href="#password-info" data-bs-toggle="tab">å¯†ç¢¼è®Šæ›´</a>
              <a href="#weather-info" data-bs-toggle="tab">å³æ™‚å¤©æ°£</a>
<!--               <a th:href="@{/shop/customer-login}">Logout</a> -->
            </div>
          </div>

          <!-- å…§å®¹å€ -->
          <div class="col-lg-12 col-md-12">
            <div class="tab-content" id="myaccountContent">

              <!-- Account Info -->
              <div class="tab-pane fade show active" id="account-info" role="tabpanel">
                <div class="myaccount-content">
                  <h3>åŸºæœ¬è³‡æ–™</h3>
                  <div class="account-details-form">
<!--                     <form action="#" method="post" enctype="multipart/form-data"> -->
					<form id="editFormInfo" th:action="@{/member/updateBasicInfo}" method="post" th:object="${MemberVO}" enctype="multipart/form-data">
                      <div class="row">
                        <!-- å·¦å´æ¬„ -->
                        <div class="col-lg-6">   
                          <div>
                          	<input type="hidden" th:field="*{memberId}" />
                          </div>                                     
                          <div class="single-input-item">
                            <label for="full-name" class="required">å§“å</label>
                            <input type="text" th:field="*{name}" id="full-name" class="form-control fs-6" 
                            	required minlength="2" maxlength="20"
         						pattern="^[\u4e00-\u9fa5a-zA-Z\s]+$"
         						title="è«‹è¼¸å…¥ä¸­æ–‡æˆ–è‹±æ–‡å§“å (2-20å­—)" />
                            <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="error" id="name.errors"></span>
                          </div>
                          <div class="single-input-item mt-3">
                            <label for="birthday" class="required">ç”Ÿæ—¥</label>
<!--                             <input type="date" th:field="*{birthday}" id="birthday" class="form-control" /> -->
							<!-- å‰ç«¯date pickerä¸æ”¯æ´thymeleaf th:fieldå¯«æ³•, æ•…æ”¹ç”¨ä»¥ä¸‹æ–¹å¼å‚³å€¼ -->
							<input type="date" th:value="${#temporals.format(MemberVO.birthday, 'yyyy-MM-dd')}"
       							name="birthday" class="form-control fs-6" />
                            <span th:if="${#fields.hasErrors('birthday')}" th:errors="*{birthday}" class="error" id="birthday.errors"></span>
                          </div>
                          <div class="single-input-item mt-3">
                            <label for="gender" class="required">æ€§åˆ¥</label>
                            <select id="gender" class="form-control" th:field="*{gender}">
    							<option value="" disabled>è«‹é¸æ“‡æ€§åˆ¥</option>
    							<option value="å¥³">å¥³</option>
    							<option value="ç”·">ç”·</option>
    							<option value="å…¶ä»–">å…¶ä»–</option>
  							</select>
                          </div>
                          <!-- Addressee -->
                          <div class="single-input-item">
                            <label for="recipient" >æ”¶ä»¶äºº</label>
                            <input type="text" th:field="*{recipientName}" id="recipientName" class="form-control fs-6" />
                            <span th:if="${#fields.hasErrors('recipientName')}" th:errors="*{recipientName}" class="error" id="recipientName.errors"></span>
                          </div>
                          
                          <div class="single-input-item">
                            <label for="address" >åœ°å€</label>
                            <input type="text" th:field="*{address}" id="address" class="form-control fs-6" />
                            <span th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="error" id="address.errors"></span>
                          </div>
                          
                          <div class="single-input-item">
                            <label for="phone" >é›»è©±</label>
                            <input type="tel" th:field="*{phone}" id="phone" class="form-control fs-6" />
                            <span th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}" class="error" id="phone.errors"></span>
                          </div>
                          
                          <!-- å„²å­˜è®Šæ›´æŒ‰éˆ• -->
                          <div class="single-input-item mt-4">
                            <div class="row">
                              <div class="col-6">
                                <button type="submit" class="check-btn sqr-btn w-100">å„²å­˜è®Šæ›´</button>
                              </div>
                              <div class="col-6">
                                <button type="reset" class="check-btn sqr-btn w-100">é‡è¨­</button>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- å³å´æ¬„ -->
                        <div class="col-lg-6 text-center">
                          <div class="single-input-item">
                            <label class="required d-block mb-2">é ­åƒ</label>                             
                             <img id="avatar-preview" th:src="@{/util/DBPicReader1} + '?memberId=' + ${MemberVO.memberId}"
										alt="é ­åƒé è¦½" class="img-thumbnail mb-3"
                              style="width: 250px; height: 250px; object-fit: cover;"/>
                              
                            <div class="d-flex justify-content-center">
                              <label for="avatar-upload" class="btn btn-outline-primary">é¸æ“‡é ­åƒ</label>
                              <input type="file" id="avatar-upload" name="pic" accept="image/*"
                                class="d-none" onchange="previewImage(event)" />
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                    <!-- éŒ¯èª¤è¡¨åˆ— -->
					<p></p>
<!-- 					<div class="errorblock  text-left" th:if="${errorMessage}" th:text="${errorMessage}"></div> -->
<!-- 					<div class="successblock  text-left" th:if="${logoutMessage}" th:text="${logoutMessage}"></div> -->
					<div class="alert alert-danger d-flex align-items-center mt-4" role="alert" th:if="${errorMessage}">
  						<i class="bi bi-exclamation-triangle-fill me-2" style="font-size: 1.5rem;"></i>
  						<span th:text="${errorMessage}"></span>
					</div>
					<div class="alert alert-success fade-in d-flex align-items-center mt-4" role="alert" th:if="${successMessage}">
  						<i class="bi bi-check-circle-fill me-2" style="font-size: 1.5rem;"></i>
  						<span th:text="${successMessage}"></span>
					</div>
					<!-- éŒ¯èª¤è¡¨åˆ— -->
                  </div>
                </div>
              </div>
              <!-- /Account Info -->

			  <!-- Password Info -->
			  			  
			  <div class="tab-pane fade" id="password-info" role="tabpanel">
                <div class="myaccount-content">
                  <h3>å¯†ç¢¼è®Šæ›´</h3>
                  <form id="editFormPwd" th:action="@{/member/updatePassword}" method="post" th:object="${MemberVO}" enctype="multipart/form-data">
                    <div class="row">
                        <!-- å·¦å´æ¬„ -->
                        <div class="col-lg-12">  
                        
						<div>
                          	<input type="hidden" id="memberId-pwd" th:field="*{memberId}" />
                        </div>
                        
                        <input type="text" name="username" autocomplete="username" value="[[${MemberVO.account}]]" hidden />

                        <div class="single-input-item  mt-3">
                          <label for="current-pwd" class="required">ç›®å‰å¯†ç¢¼</label>
                          <input type="password" id="current-pwd" th:field="*{password}"
                            placeholder="è«‹è¼¸å…¥ç›®å‰å¯†ç¢¼" autocomplete="current-password"
                            pattern="[A-Za-z0-9]+" title="åƒ…å…è¨±æ•¸å­—æˆ–è‹±æ–‡å¤§å°å¯«" maxlength="20" class="form-control fs-6" required />
                        </div>
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item  mt-3">
                              <label for="new-pwd" class="required">æ–°å¯†ç¢¼</label>
                              <input type="password" id="new-pwd" name="newPassword"
                                placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼" autocomplete="new-password"
                                pattern="[A-Za-z0-9]+" title="åƒ…å…è¨±æ•¸å­—æˆ–è‹±æ–‡å¤§å°å¯«" maxlength="20" class="form-control fs-6" required />
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item  mt-3">
                              <label for="confirm-pwd" class="required">ç¢ºèªæ–°å¯†ç¢¼</label>
                              <input type="password" id="confirm-pwd" name="confirmPassword"
                                placeholder="è«‹å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼" autocomplete="new-password"
                                pattern="[A-Za-z0-9]+" title="åƒ…å…è¨±æ•¸å­—æˆ–è‹±æ–‡å¤§å°å¯«" maxlength="20" class="form-control fs-6" required />
                            </div>
                          </div>
                        </div>
                        <!-- å„²å­˜è®Šæ›´æŒ‰éˆ• -->
                          <div class="single-input-item mt-4">
                            <div class="row">
                              <div class="col-6">
<!--                                 <button type="submit" class="check-btn sqr-btn w-100">å¯†ç¢¼è®Šæ›´</button> -->
									 <button type="submit" class="btn btn-outline-success w-100 d-flex align-items-center justify-content-center gap-2">
  										<i class="bi bi-shield-lock-fill"></i> å¯†ç¢¼è®Šæ›´
									 </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                    <!-- éŒ¯èª¤è¡¨åˆ— -->
					<p></p>
<!-- 					<div class="errorblock  text-left" th:if="${errorMessage}" th:text="${errorMessage}"></div> -->
<!-- 					<div class="successblock  text-left" th:if="${logoutMessage}" th:text="${logoutMessage}"></div> -->
					<div class="alert alert-danger d-flex align-items-center mt-4" role="alert" th:if="${errorMessage}">
  						<i class="bi bi-exclamation-triangle-fill me-2" style="font-size: 1.5rem;"></i>
  						<span th:text="${errorMessage}"></span>
					</div>
					<div class="alert alert-success fade-in d-flex align-items-center mt-4" role="alert" th:if="${successMessage}">
  						<i class="bi bi-check-circle-fill me-2" style="font-size: 1.5rem;"></i>
  						<span th:text="${successMessage}"></span>
					</div>
					<!-- éŒ¯èª¤è¡¨åˆ— -->
                </div>
              </div>
			  <!-- /Password Info -->
			  
			  <!-- Weather Info --> 			  
			  <div class="tab-pane fade" id="weather-info" role="tabpanel">
                <div class="myaccount-content">
                    <h1>ğŸŒ¦ å³æ™‚å¤©æ°£</h1>
                    <div id="result" class="weather-box p-4 border rounded text-left shadow-sm">
  						æ­£åœ¨è¼‰å…¥å¤©æ°£è³‡è¨Š...
					</div>
                    <!-- éŒ¯èª¤è¡¨åˆ— -->
					<!-- /éŒ¯èª¤è¡¨åˆ— -->
                </div>
              </div>
			  <!-- /Weather Info -->

            </div>
          </div>
          <!-- /tab content -->
        </div>
      </div>
    </div>
  </div>
</div>

	<!-- end page wrapper -->
</section>
<th:block th:fragment="extraJs">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å¦‚æœé‚„æœ‰ä½ çš„é é¢åœ–è¡¨åˆå§‹åŒ– JSï¼Œå¯æ”¾é€™è£¡ -->
    
    <script>
document.getElementById("editFormPwd").addEventListener("submit", function(event) {
  const newPwd = document.getElementById("new-pwd").value;
  const confirmPwd = document.getElementById("confirm-pwd").value;

  if (newPwd !== confirmPwd) {
    event.preventDefault(); // é˜»æ­¢æäº¤
    alert("æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´ï¼");
  }
});
</script>
    
	 <!-- é ­åƒé è¦½ -->
  <script>
    function previewImage(event) {
      const reader = new FileReader();
      reader.onload = function () {
        document.getElementById('avatar-preview').src = reader.result;
      };
      reader.readAsDataURL(event.target.files[0]);
    }
  </script>
  
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const hash = window.location.hash;

    if (hash) {
      // ç§»é™¤æ‰€æœ‰ tab çš„ active æ¨£å¼
      document.querySelectorAll('.myaccount-tab-menu a').forEach(function (tabLink) {
        tabLink.classList.remove('active');
      });

      document.querySelectorAll('.tab-pane').forEach(function (tabPane) {
        tabPane.classList.remove('show', 'active');
      });

      // å¥—ç”¨æ–°çš„ active æ¨£å¼
      const targetTabLink = document.querySelector(`.myaccount-tab-menu a[href="${hash}"]`);
      const targetTabPane = document.querySelector(hash);

      if (targetTabLink && targetTabPane) {
        targetTabLink.classList.add('active');
        targetTabPane.classList.add('show', 'active');
      }
    }
  });
</script>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
	  const alertBoxes = document.querySelectorAll('.alert');
	  alertBoxes.forEach((alertBox) => {
	    setTimeout(() => {
	      alertBox.style.transition = 'opacity 0.5s ease';
	      alertBox.style.opacity = '0';
	      setTimeout(() => alertBox.remove(), 500);
	    }, 3000); // 3 ç§’å¾Œæ¶ˆå¤±
	  });
	});
</script>

  <script>
    window.onload = function() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          fetch(`/member/weather?lat=${lat}&lon=${lon}`)
            .then(res => res.json())
            .then(data => {
            	document.getElementById("result").innerHTML = `
            		  <div class="fs-5 mb-2">åœ°å€: <strong>${data.city}</strong></div>
            		  <div class="fs-5 mb-2">æº«åº¦: <span class="text-primary fw-bold">${data.temp}Â°C</span></div>
            		  <div class="fs-5 mb-2">å¤©æ°£: <span class="text-secondary">${data.description}</span></div>
            		`;
            })
            .catch(err => {
              document.getElementById("result").innerText = "ç„¡æ³•å–å¾—å¤©æ°£è³‡è¨Š";
              console.error(err);
            });
        }, function(error) {
          document.getElementById("result").innerText = "ç„¡æ³•å–å¾—å®šä½ï¼Œè«‹å…è¨±ç€è¦½å™¨å­˜å–ä½ç½®";
        });
      } else {
        document.getElementById("result").innerText = "ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½";
      }
    }
  </script>
        
  </th:block>
</body>
</html>
